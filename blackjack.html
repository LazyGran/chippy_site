<!DOCTYPE html>
<html lang="en">
<link rel="icon" href="gambling_favicon.png" type="image/png" />
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chippy - Gambling Bot</title>
  <style>
    body 
    {
      margin: 0;
      background-color: #242424; 
      color: #eee;
      font-family: Arial, sans-serif;
    }
    header 
    {
      background: url('gambling_banner.png') no-repeat center center/cover;
      height: 370px;
      min-height: 100;
      height: 30vw;
      max-height: 300px;
      border: 7px solid #181830;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    header img 
    {
      min-width: 110px;
      width: 15vw;
      max-width: 220px;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      border: 7px solid #181830;
      position: absolute;
      bottom: -90px;
    }
    main 
    {
      max-width: 600px;
      margin: 100px auto 0;
      padding: 0 20px;
      text-align: center;
    }
    main a 
    {
      color: #4ea1d3;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    main a:hover 
    {
      text-decoration: underline;
      color: #181830;
    }
    nav 
    {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-weight: bold;
    }
    nav a 
    {
      color: #4ea1d3;
      text-decoration: none;
    }
    nav a:hover 
    {
      text-decoration: underline;
      color: #181830;
    }
    footer
    {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      background-color: #242424;
      color: #aaa;
      font-size: 0.9em;
      border-top: 7px solid #181830;
      box-sizing: border-box;
      font-weight: bold;
    }
    .card 
    {
      vertical-align: bottom;
      min-width: 40;
      width: 20vw;
      max-width: 80px;
      height: 24vw;
      min-height: 45px;
      max-height: 90px; 
      border-radius: 8px;
      filter: drop-shadow(0 4px 16px rgba(0,0,0,1));
      position: relative;
      display: inline-block;
      margin-bottom: 0px;
      margin-left: -7px;
      transition: transform 0.4s ease, opacity 0.4s ease;
      opacity: 0;
      transform: translateY(-20px);
    }
    .card:first-child 
    {
      margin-left: 0;
    }
    .card.show 
    {
      opacity: 1;
      transform: translateY(0);
    }
    #player-cards, #dealer-cards 
    {
      display: inline-flex;
      justify-content: center;
      position: relative;
      padding-left: 40px;
    }
    #hand
    {
      display: flex;
      flex-wrap: wrap; 
      justify-content: center;
      min-height: 90px;
    }
    button 
    {
      background-color: #4ea1d3;
      color: white;
      border: none;
      min-width: 50px;
      width: 24vw;
      max-width: 100px;
      min-height: 25;
      height: 12vw;
      max-height: 50px;
      margin: 0 10px;
      border-radius: 8px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover 
    {
      background-color: #367da3;
    }
  </style>
</head>
<body>
  <header>
    <img src="gambling_pfp.png" alt="Chippy Avatar" />
  </header>
  <main>
    <h1>Blackjack</h1>
    <p>
      Dealer stands on soft 17 and higher<br>
    </p>
    <h1 id="state" style="font-size: 1.5em"></h2>
    <div id="blackjack-game" style="text-align:center; margin-top: 50px;">
      <div style="margin-top: 20px;">
        <a href="#" onclick="hit(); return false;">
          <button id="b_hit">Hit</button>
        </a>
        <a href="#" onclick="restart(); return false;">
          <button id="b_restart" style="display: none">Restart</button>
        </a>
        <a href="#" onclick="stand(); return hit_enabled = false;">
          <button id="b_stand">Stand</button>
        </a>
      </div>
      <div style="margin-top: 50px;">
        <div id="hand"></div>
        <h3 >Your Hand</h3>
      </div>
      <div>
        <h3>Dealer's Hand</h3>
        <div id="dealer_hand" style="height: 120px;"></div>
      </div>
      <div id="status" style="margin-top: 1px; font-weight: bold; color: #eee;"></div>
    </div>
    <br><br><br>
  </main>
<footer>
  <div style="flex: 1; text-align: left;">
    <a href="terms.html" style="color: #4ea1d3; text-decoration: none;">
      Terms of Service & Privacy Policy
    </a>
  </div>
  <div style="flex: 1; text-align: center;">
    <a href="https://github.com/LazyGran/chippy_site" style="color: #aaaaaa; text-decoration: none;">
      Website's Github repository
    </a>
  </div>
  <div style="flex: 1; text-align: right; font-style: italic;">
    The House always wins... eventually.
  </div> 
</footer>
<script>

  var template  = [ "Aceh", "Aces", "Aced", "Acec", "2h", "2s", "2d", "2c", "3h", "3s", "3d", "3c", "4h", "4s", "4d", "4c", "5h", "5s", "5d", "5c", "6h", "6s", "6d", "6c", "7h", "7s", "7d", "7c", "8h", "8s", "8d", "8c", "9h", "9s", "9d", "9c", "10h", "10s", "10d", "10c", "Jackh", "Jacks", "Jackd", "Jackc", "Queenh", "Queens", "Queend", "Queenc", "Kingh", "Kings", "Kingd", "Kingc" ]
  var deck      = template

  var hand          = []
  var points        = 0
  var dealer_hand   = []
  var dealer_points = 0
  var hit_enabled   = true
  var stand_enabled = true
  var busted        = false

  const cards =
  {
      "Aceh": "Ace",
      "Aces": "Ace",
      "Aced": "Ace",
      "Acec": "Ace",
      "2h": 2,
      "2s": 2,
      "2d": 2,
      "2c": 2,
      "3h": 3,
      "3s": 3,
      "3d": 3,
      "3c": 3,
      "4h": 4,
      "4s": 4,
      "4d": 4,
      "4c": 4,
      "5h": 5,
      "5s": 5,
      "5d": 5,
      "5c": 5,
      "6h": 6,
      "6s": 6,
      "6d": 6,
      "6c": 6,
      "7h": 7,
      "7s": 7,
      "7d": 7,
      "7c": 7,
      "8h": 8,
      "8s": 8,
      "8d": 8,
      "8c": 8,
      "9h": 9,
      "9s": 9,
      "9d": 9,
      "9c": 9,
      "10h": 10,
      "10s": 10,
      "10d": 10,
      "10c": 10,
      "Jackh": "Jack",
      "Jacks": "Jack",
      "Jackd": "Jack",
      "Jackc": "Jack",
      "Queenh": "Queen",
      "Queens": "Queen",
      "Queend": "Queen",
      "Queenc": "Queen",
      "Kingh": "King",
      "Kings": "King",
      "Kingd": "King",
      "Kingc": "King"
  }

  const values = 
  {
  "Ace":  11,
  "Jack": 10,
  "Queen": 10,
  "King": 10
  }

  initial()

  async function initial()
  {
    for(let i = 0; i < 2; i++)
    {
      points          = await player_draw(hand, points)
      dealer_points   = await dealer_draw(dealer_hand, dealer_points)
    }
  } 

  async function player_draw(hand, points)
  {
    const card = Math.floor(Math.random() * (deck.length - 1))

    add("hand", deck[card])

    deck.splice(card, 1)

    hand.push(cards[deck[card]])

    return calculate(hand)
  }

  async function dealer_draw(dealer_hand, dealer_points)
  {
    const card = Math.floor(Math.random() * (deck.length - 1))

    add("dealer_hand", deck[card])

    deck.splice(card, 1)

    dealer_hand.push(cards[deck[card]])

    dealer_points   += values[cards[deck[card]]] || cards[deck[card]]

    return calculate(dealer_hand)
  }

  async function calculate(hand)
  {
    let total = 0
    let aces  = 0

    for(let card of hand)
    {
      if(card === "Ace")
      {
        total += 11
        aces ++
      }
      else total += values[card] || card;
    }

    while (total > 21 && aces > 0)
    {
      total -= 10
      aces --
    }

    return total
  }

  function add(cID, name)
  {
    const container = document.getElementById(cID)
    const image     = document.createElement("img")

    image.src       = `cards/${name}.png`
    image.className = "card"

    container.appendChild(image)

    setTimeout(() => 
    {
      image.classList.add("show")
    }, 50)
  }

  async function stand()
  {
    if(stand_enabled)
    {
      stand_enabled = false 

      while(dealer_points < 17)
      {
        dealer_points = await dealer_draw(dealer_hand, dealer_points)
      }

      console.log(points, dealer_points)
      const state = document.getElementById("state");

      if(busted)
      {
        //player bust
        state.innerHTML = `<span style="color: red">Bust!</span> You went over 21.`
      }
      else if(dealer_points > 21)
      {
        //dealer bust
        state.innerHTML = `<span style="color: green">Win!</span> The dealer went over 21.`
      }
      else if(points > dealer_points)
      {
        //player win
        state.innerHTML = `<span style="color: green">Win!</span> You have more points.`
      }
      else if(points === dealer_points)
      {
        //push
        state.innerHTML = `<span style="color: yellow">Push!</span> You & the Dealer have the same points.`
      }
      else
      {
        //lost
        state.innerHTML = `<span style="color: red">Lost!</span> The Dealer has more points.`
      }

      document.getElementById("b_restart").style.display  = "inline-block"
      document.getElementById("b_hit").style.display      = "none"
      document.getElementById("b_stand").style.display    = "none"
    }
  }

  async function hit()
  {
    if(hit_enabled)
    {
      points = await player_draw(hand, points)

      if(points > 21)           
      {
        hit_enabled   = false
        busted        = true

        stand()
      }
    }
  }

  function restart()
  {
    hand          = []
    points        = 0
    dealer_hand   = []
    dealer_points = 0
    hit_enabled   = true
    stand_enabled = true
    busted        = false

    deck = template

    const dealer = document.getElementById("dealer_hand")
    const player = document.getElementById("hand")

    const d_cards = dealer.querySelectorAll(".card")
    const p_cards = player.querySelectorAll(".card")

    d_cards.forEach(card =>
    {
      card.classList.remove("show")

      setTimeout(() =>
      {
        card.remove()
      }, 400)
    })

    p_cards.forEach(card =>
    {
      card.classList.remove("show")

      setTimeout(() =>
      {
        card.remove()
      }, 400)
    })

    setTimeout(() =>
    {
      state.innerHTML = "";

      document.getElementById("b_restart").style.display  = "none"
      document.getElementById("b_hit").style.display      = "inline-block"
      document.getElementById("b_stand").style.display    = "inline-block"

      initial()
    }, 500)
  }
</script>
</body>
</html>
